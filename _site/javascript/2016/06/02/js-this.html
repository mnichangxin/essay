<!DOCTYPE html>
<html>

  <head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	<meta name="description" content="说道 JavaScript 高大上的技巧，this 关键字莫过之一了，而且 this 的使用频率相当高。不同与 Java 中 this 的三种用法，JavaScript 的 this 明确说只有一种用法，那就是 指向调用函数的对象 。下面分三种情况讨论：">
	<title>JavaScript this关键字</title>
	<link rel="stylesheet" type="text/css" href="http://mnichangxin.github.io/essay/css/bootstrap/css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="http://mnichangxin.github.io/essay/css/index.css">
</head>

  <body>

    <header>
  <div class="container-fluid header">
    <div class="row title">
      <div class="col-md-12">
        <h1 class="text-center"><span class="glyphicon glyphicon-pencil"></span> essay</h1>
        <h3 class="text-center">这里有诗和远方的遐想</h3>
      </div>
    </div>
    <div class="nav-menu">
        <ul class="nav nav-pills">
          <li>
            <a href="http://mnichangxin.github.io/essay"><span class="glyphicon glyphicon-home"></span> Home</a>
          </li>
          <li class="Date">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-calendar"></span> Date <span class="caret"></span></a>
            <ul class="dropdown-menu">
              
                <li><a href="http://mnichangxin.github.io/essay/java/2016/06/10/welcome-to-jekyll.html">Jun 10, 2016</a></li>
              
                <li><a href="http://mnichangxin.github.io/essay/css/2016/06/06/bfc.html">Jun 6, 2016</a></li>
              
                <li><a href="http://mnichangxin.github.io/essay/java/2016/06/05/java-io.html">Jun 5, 2016</a></li>
              
                <li><a href="http://mnichangxin.github.io/essay/javascript/2016/06/02/js-this.html">Jun 2, 2016</a></li>
              
                <li><a href="http://mnichangxin.github.io/essay/css/2016/05/26/box-model.html">May 26, 2016</a></li>
              
            </ul>
          </li>
          <li class="categories">
            <a href="" class="dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-th-list"></span> Category <span class="caret"></span></a>
            <ul class="dropdown-menu">
              

                <li><a href=""><span class="badge">2</span> CSS</a></li>

              

                <li><a href=""><span class="badge">1</span> JavaScript</a></li>

              

                <li><a href=""><span class="badge">2</span> Java</a></li>

              
            </ul>
          </li>
        </ul>
    </div>
  </div>
</header>


    <div class="container page-content">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">JavaScript this关键字</h1>
    <p class="post-meta"><time datetime="2016-06-02T00:00:00+08:00" itemprop="datePublished">Jun 2, 2016</time></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>说道 <code class="highlighter-rouge">JavaScript</code> 高大上的技巧，<code class="highlighter-rouge">this</code> 关键字莫过之一了，而且 <code class="highlighter-rouge">this</code> 的使用频率相当高。不同与 <code class="highlighter-rouge">Java</code> 中 <code class="highlighter-rouge">this</code> 的三种用法，<code class="highlighter-rouge">JavaScript</code> 的 <code class="highlighter-rouge">this</code> 明确说只有一种用法，那就是 <strong>指向调用函数的对象</strong> 。下面分三种情况讨论：</p>

<hr />

<h2 id="section">作为对象方法调用</h2>

<div class="language-js highlighter-rouge"><pre class="highlight"><code>    <span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">x</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="na">foo</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">obj</span><span class="p">.</span><span class="nx">foo</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span> <span class="c1">//10</span>
</code></pre>
</div>

<p>这一种情况， <code class="highlighter-rouge">this</code> 绑定了调用函数的 <code class="highlighter-rouge">obj</code> 对象</p>

<hr />

<h2 id="section-1">作为函数调用</h2>

<p>这种情况其实和第一种情况类似，请看：</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code>    <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">foo</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span>
    <span class="p">}</span> 
    <span class="nx">foo</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span> <span class="c1">//10</span>
</code></pre>
</div>

<p>这里的 <code class="highlighter-rouge">this</code> 指向了全局 <code class="highlighter-rouge">window</code> , 类比第一种情况，可以写成这样(假设可以)：</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code>    <span class="kd">var</span> <span class="nb">window</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">x</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="na">foo</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">};</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">foo</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span> <span class="c1">//10</span>
</code></pre>
</div>

<p>呵呵~~看出个所以然了吧，这不就是把全局 <code class="highlighter-rouge">window</code> 当做 <code class="highlighter-rouge">this</code> 绑定的对象嘛！</p>

<p>还有一种特例就是，对象函数的内部函数会丢失当前对象 <code class="highlighter-rouge">this</code> 的引用，请看：</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code>    <span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">x</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="na">foo</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">boo</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span>
          <span class="p">};</span>
          <span class="nx">boo</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">obj</span><span class="p">.</span><span class="nx">foo</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span> <span class="c1">//0</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span> <span class="c1">//10</span>
</code></pre>
</div>

<p>明显，<code class="highlighter-rouge">boo</code> 函数的 <code class="highlighter-rouge">this</code> 指向了全局 <code class="highlighter-rouge">window</code> , <code class="highlighter-rouge">x</code> 的值并没有因此改变。遇到这种情况，可以这样解决：</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code>    <span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">x</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="na">foo</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span> <span class="c1">//保存当前this引用</span>
          <span class="kd">var</span> <span class="nx">boo</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">that</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span>
          <span class="p">};</span>
          <span class="nx">boo</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
        <span class="p">}</span>
  <span class="p">};</span>
  <span class="nx">obj</span><span class="p">.</span><span class="nx">foo</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span> <span class="c1">//10</span>
</code></pre>
</div>

<p>这里用一个 <code class="highlighter-rouge">that</code> 变量保存了 <code class="highlighter-rouge">this</code> 引用，以致于 <code class="highlighter-rouge">that</code> 指向当前对象。</p>

<hr />

<h2 id="section-2">作为构造函数调用</h2>

<div class="language-js highlighter-rouge"><pre class="highlight"><code>    <span class="kd">function</span> <span class="nx">Foo</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">foo1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Foo</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">foo</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span> <span class="c1">//10</span>
</code></pre>
</div>

<p>当构造函数被实例化时，<code class="highlighter-rouge">this</code> 自动指向实例化对象。</p>

<p>总结以上三种情况，都归结于一句话：<strong><code class="highlighter-rouge">this</code> 指向调用函数的对象</strong>。</p>

<hr />

<h2 id="apply--call">apply() 和 call()</h2>

<p>最后，说一下 <code class="highlighter-rouge">JavaScritp</code> 提供的改变 <code class="highlighter-rouge">this</code> 绑定的方法 <code class="highlighter-rouge">apply()</code> 和 <code class="highlighter-rouge">call()</code> 。这两个方法都接收两个参数：要应用的对象和传入的参数，它们唯一的区别是 <code class="highlighter-rouge">apply()</code> 的参数传入一个数组，<code class="highlighter-rouge">call()</code> 只能一个一个的传入参数。知其一必知其二，下面我们拿 <code class="highlighter-rouge">apply()</code> 说事：</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code>   <span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{</span>
     <span class="na">x</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
     <span class="na">y</span><span class="p">:</span> <span class="mi">10</span>
   <span class="p">};</span>

   <span class="kd">var</span> <span class="nx">foo</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
     <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
   <span class="p">};</span>
   
   <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">foo</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">obj</span><span class="p">));</span> <span class="c1">//0</span>

</code></pre>
</div>

<p>函数 <code class="highlighter-rouge">Foo</code> 绑定了对象 <code class="highlighter-rouge">obj</code> ，于是 <code class="highlighter-rouge">this</code> 指向 <code class="highlighter-rouge">obj</code> ，这是 <code class="highlighter-rouge">apply()</code> 最简单的用法。</p>

<p><code class="highlighter-rouge">apply()</code> 还有一个很有用的用法，说明一下：</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code>    <span class="kd">var</span> <span class="nx">array</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">];</span>
    
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">array</span><span class="p">));</span> <span class="c1">//5</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">array</span><span class="p">));</span> <span class="c1">//1</span>
</code></pre>
</div>

<p>数组被传入 <code class="highlighter-rouge">Math.max()</code> 和 <code class="highlighter-rouge">Math.min()</code> 方法中，第一个参数置空，表示没有对象调用。它们返回了数组的最大值和最小值</p>


  </div>

</article>

    </div>

    <script src="http://mnichangxin.github.io/essay/js/jquery-2.2.4.js"></script>
    <script src="http://mnichangxin.github.io/essay/js/bootstrap.min.js"></script>
    <script src="http://mnichangxin.github.io/essay/js/index.js"></script>
  </body>

</html>
